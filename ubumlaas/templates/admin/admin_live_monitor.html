{% extends "base.html" %}

{% block content%}
<main class="content">
    <div class="container-fluid p-0">
        <div class="row d-flex">
            <div class="col-auto">
                <h1 class="h3 mb-3"><strong>System Monitor</strong></h1>
            </div>
            <div class="col-auto">
                <a style="color: var(--info);" href="#a" data-trigger="focus" title="" data-container="body" data-toggle="popover"
                    data-placement="right" data-content="Data is updated once every minute. Some inconsistency might be possible.">
                    <i class="fa-solid fa-circle-info"></i>
                </a>
            </div>
        </div>
        <div class="row d-flex">
            <div class="col-xl-12 col-xxl-5 d-flex">
                <div class="w-100">
                    <div class="row">
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">CPU Load</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-server"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="canvas-holder" style="height:100%">
                                        <canvas id="CPU_Total"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">CPU Cores</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-user"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <h1 class="h1 mt-5 mb-3 align-items-center d-flex justify-content-center">{{ cards_data.cpu_cpucore }}</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">Memory Load</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-microchip"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="canvas-holder" style="width:100%">
                                        <canvas id="Mem_Total"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">Used Memory</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-user"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <h1 class="h1 mt-5 mb-3 align-items-center d-flex justify-content-center">{{ cards_data.mem_in_use }} {{ cards_data.mem_label }}</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">Storage in use</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-microchip"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="canvas-holder" style="width:100%">
                                        <canvas id="Storage_in_Use"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="card h-75">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">Storaged Used</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-user"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <h1 class="h1 mt-5 mb-3 align-items-center d-flex justify-content-center">{{ cards_data.storage_in_use }} {{
                                        cards_data.storage_label }}</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">System Load</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="align-middle fa fa-server"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="canvas-holder" style="height:100%">
                                        <canvas id="system_load"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col mt-0">
                                            <h5 class="card-title">I/O Usage</h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="stat text-primary">
                                                <i class="fa fa-bolt-lightning"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="canvas-holder" style="height:100%">
                                        <canvas id="io_usage"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</main>
{% endblock content %}

{% block js %}
<script>
    $('[data-toggle="popover"]').popover(); 
</script>
<script>
    // Gauges
    var config = JSON.parse(JSON.stringify(configBaseGauge));
    var config2 = JSON.parse(JSON.stringify(configBaseGauge));
    var config3 = JSON.parse(JSON.stringify(configBaseGauge));
    config.data.datasets[0].value = '{{ cards_data.cpu_total }}';
    config2.data.datasets[0].value = '{{ cards_data.mem_percent }}';
    config3.data.datasets[0].value = '{{ cards_data.storage_in_use_percent }}';
   
    // Bar Chart
    var sysLoadTimestamp = "{{ system_load.timestamp | safe }}";
    sysLoadTimestamp = sysLoadTimestamp.replace(/'/g, '');
    sysLoadTimestamp = sysLoadTimestamp.replace('[', '');
    sysLoadTimestamp = sysLoadTimestamp.replace(']', '');
    sysLoadTimestamp = sysLoadTimestamp.split(',');

    var sysLoad = '{{ system_load.system_load_1 }}';
    sysLoad = sysLoad.replace('[', '');
    sysLoad = sysLoad.replace(']', '');
    sysLoad = sysLoad.split(',');
    sysLoad = sysLoad.map(Number);
    var config4 = {
        type: "bar",
        data: {
            labels: sysLoadTimestamp,
            datasets: [{
                label: "System Load",
                backgroundColor: CHART_COLORS.ubu,
                borderColor: CHART_COLORS.ubu,
                hoverBackgroundColor: CHART_COLORS.ubu,
                hoverBorderColor: CHART_COLORS.ubu,
                data: sysLoad,
                barPercentage: .75,
                categoryPercentage: .5
            }]
        },
        options: {
            responsive: !window.MSInputMethodContext,
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        stepSize: 0.5,
                        suggestedMin: 0,
                        suggestedMax: 1
                    }
                }]
            },
            plugins: {
                legend: false,
                datalabels: {
                    display: false,
                }
            }
        }
    }

    // Line Chart
    

    window.onload = function () {
        var ctx = document.getElementById('CPU_Total').getContext('2d');
        cpuTotal = new Chart(ctx, config);
        var ctx2 = document.getElementById('Mem_Total').getContext('2d');
        memTotal = new Chart(ctx2, config2);
        var ctx3 = document.getElementById('Storage_in_Use').getContext('2d');
        storageInUse = new Chart(ctx3, config3);
        var ctx4 = document.getElementById('system_load').getContext('2d');
        systemLoad = new Chart(ctx4, config4);
        var ctx5 = document.getElementById('io_usage').getContext('2d');
        ioUsage = new Chart(ctx5, config5);
    };
</script>
<!--<script type="module">
    import MyComponent from '{{ url_for("static", filename="js/live_monitor.js") }}';
    Vue.createApp(MyComponent).mount('#CPU_Total');
</script>-->
{% endblock js %}