matrix:
  include:
      - os: linux
        dist: xenial
        sudo: required
        language: python
        python: 3.6
        node_js: 10

addons:
  chrome: stable

services:
  - redis-server
  - xvfb

git:
  depth: 3

install:
  - cd $TRAVIS_BUILD_DIR
  - pip install -r requirements.txt
  - wget http://mirror.jkanetwork.com/Datasets/data.sqlite -O ./ubumlaas/data.sqlite
  - wget http://mirror.jkanetwork.com/Datasets/ubumlaas.tar -O /tmp/ubumlaas.tar
  - mkdir -p $TRAVIS_BUILD_DIR/ubumlaas/datasets/ubumlaas
  - tar -xvf /tmp/ubumlaas.tar -C $TRAVIS_BUILD_DIR/ubumlaas/datasets/ubumlaas
  - npm install -g selenium-side-runner
  - npm install -g chromedriver

before_script:
  - wget http://mirror.jkanetwork.com/Datasets/env_variables.sh -O env_variables.sh
  - source env_variables.sh
  - "export DISPLAY=:99.0"
  - 
  - sleep 3
  - python app.py &
  - sleep 20

script:
  - python tests.py
  - xvfb-run --server-args="-screen 0 1024x768x24" make test
  - selenium-side-runner ./test/UBUMLaaS.side
